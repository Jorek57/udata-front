{% extends theme('layouts/1-column.html') %}
{% from theme('macros/follow.html') import follow_btn with context %}
{% from theme('macros/organization_name_with_certificate.html') import organization_name_with_certificate %}

{% set bundle = 'user' %}

{% set meta = {
    'title': user.fullname,
    'description': _("%(site)s %(username)s profile", site=config['SITE_TITLE'], username=user.fullname),
    'keywords': [_('user'), _('profile')],
    'robots': 'noindex',
} %}

{% block breadcrumb %}
<li>
    <a class="fr-breadcrumb__link">
        {{ _('Users') }}
    </a>
</li>
<li>
    <a class="fr-breadcrumb__link" aria-current="page">
        {{ user.fullname }}
    </a>
</li>
{% endblock %}

{% block toolbar %}
{% if current_user != user %}
    {{ follow_btn(user) }}
{% endif %}
{% if can_edit %}
    {% if current_user != user %}
    <a
        href="{{ url_for('admin.index', path='user/{id}/'.format(id=user.id)) }}"
        class="fr-ml-2w fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-warning-425 fr-icon-pencil-line fr-btn--icon-left"
    >
        {{ _("User's admin profile") }}
    </a>
    {% else %}
    <a
        class="fr-ml-2w fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-warning-425 fr-icon-pencil-line fr-btn--icon-left"
        href="{{ url_for('admin.index', path='me') }}"
    >
        {{ _('Edit') }}
    </a>
    {% endif %}
{% endif %}
{% endblock %}

{% block main_content %}
<div class="fr-container fr-pb-5w">
    <img
        src="{{ user|avatar_url(80) }}"
        alt=""
        class="rounded-circle"
    />
    <h1 class="fr-h3 fr-my-1v">{{ user.fullname }}</h1>
    <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--bottom justify-between">
        <div class="fr-col markdown fr-text--sm fr-m-0">
            {{ user.about|markdown(wrap=False) }}
        </div>
        {% if user.website %}
            <p class="fr-mt-1w">
                <a
                    href="{{user.website}}"
                    rel="ugc nofollow"
                    class="fr-link fr-text--sm"
                    target="_blank"
                >
                    {% set truncate_length = 15 %}
                    {% if user.website.startswith('https:') %}
                        {% set website = user.website[8:] %}
                    {% elif user.website.startswith('http:') %}
                        {% set website = user.website[7:] %}
                    {% else %}
                        {% set website = user.website %}
                    {% endif %}
                    <span class="fr-icon-global-line" aria-hidden="true"></span>
                    {{ website|truncate(truncate_length, True) }}
                </a>
            </p>
        {% endif %}
    </div>
    {% if organizations %}
        <div class="fr-mt-4w">
            <h2 class="subtitle subtitle--uppercase fr-mt-0 fr-mb-3v">{{ _('Organizations') }}</h2>
            {% for org in organizations %}
                <a
                    href="{{ url_for('organizations.show', org=org) }}"
                    class="fr-raw-link text-blue-400 fr-text--bold fr-text--sm"
                >
                    <div class="inline-block border border-default-grey rounded-xxs fr-p-1v bg-white">
                        <img
                            src="{{ org.logo(24)|placeholder('organization') }}"
                            width="24"
                            height="24"
                            alt=""
                        />
                    </div>
                    <span class="text-decoration-underline text-underline-position-under text-decoration-underline--dsfr">{{ organization_name_with_certificate(org) }}</span>
                </a>
            {% endfor %}
        </div>
    {% endif %}
</div>
<hr class="fr-py-0-5v" />
<div class="fr-container fr-mb-3w fr-mt-9v vuejs">
    {% block user_content %}
        <user-dataset-list
            owner="{{user.id}}"
        ></user-dataset-list>
        <user-reuse-list
            owner="{{user.id}}"
        ></user-reuse-list>
    {% endblock %}
</div>
{% endblock %}
